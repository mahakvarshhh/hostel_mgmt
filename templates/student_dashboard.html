<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
        background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
        font-family: 'Poppins', sans-serif;
        color: #1f2937;
        margin: 0;
    }

    /* Sidebar */
    .sidebar {
        background: #1e293b;
        color: #cbd5e1;
        min-height: 100vh;
        width: 220px;
        padding: 30px 15px;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease;
    }
    .sidebar h5 { font-weight: 700; margin-bottom: 30px; }
    .sidebar .nav-link {
        color: #cbd5e1;
        margin-bottom: 15px;
        font-size: 15px;
        padding: 12px 18px;
        border-radius: 12px;
        transition: 0.3s;
    }
    .sidebar .nav-link:hover, .sidebar .nav-link.active {
        color: #fff;
        background: #3b82f6;
    }

    /* Main content */
    .content {
        flex-grow: 1;
        padding: 30px;
    }

    /* Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 30px;
    }
    .header h2 { font-weight: 700; font-size: 26px; }
    .header .btn { position: relative; }

    /* Dashboard cards */
    .dashboard-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        transition: transform 0.3s, box-shadow 0.3s;
        text-align: center;
        padding: 25px 20px;
    }
    .dashboard-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.15);
    }
    .dashboard-card .icon-box {
        font-size: 2.5rem;
        width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50%;
        color: #fff;
        margin: 0 auto 15px;
    }
    .icon-room { background: #3b82f6; }
    .icon-roll { background: #10b981; }
    .icon-last { background: #f59e0b; }
    .dashboard-card h4 { margin-bottom: 8px; font-size: 18px; font-weight: 600; }
    .dashboard-card p { font-size: 14px; color: #4b5563; }

    /* Products */
    .product-card {
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        transition: transform 0.3s;
        background: rgba(255,255,255,0.85);
        backdrop-filter: blur(12px);
        padding: 15px;
    }
    .product-card:hover { transform: translateY(-6px); }
    .product-card .btn { font-weight: 600; border-radius: 10px; }

    /* Gate pass */
    .gate-pass-card {
        background: rgba(255,255,255,0.9);
        backdrop-filter: blur(12px);
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 18px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.06);
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .gate-pass-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 20px rgba(0,0,0,0.1);
    }

    /* Tables */
    table th, table td {
        vertical-align: middle !important;
        font-size: 14px;
        padding: 12px 10px;
    }
    .fees-table th, .fees-table td { text-align: center; }

    /* Badges */
    .badge-status { padding: 6px 10px; font-size: 12px; border-radius: 8px; font-weight: 600; }
    .badge-pending { background: #facc15; color: #000; }
    .badge-approved { background: #10b981; color: #fff; }
    .badge-rejected { background: #ef4444; color: #fff; }

    /* Animations */
    .fade-in { animation: fadeInUp 0.6s ease forwards; opacity: 0; }
    @keyframes fadeInUp {
        0% { opacity: 0; transform: translateY(20px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* Responsive */
    @media (max-width: 992px) { .sidebar { width: 180px; } .content { padding: 20px; } }
    @media (max-width: 768px) {
        .sidebar { position: fixed; z-index: 1050; left: -220px; top: 0; transition: all 0.3s; }
        .sidebar.show { left: 0; }
    }
</style>
</head>
<body>

<div class="d-flex">

    <!-- Sidebar -->
    <div class="sidebar d-flex flex-column">
        <h5 class="text-white text-center mb-4">Student Panel</h5>
        <ul class="nav nav-pills flex-column">
            <li class="nav-item">
                <a href="{{ url_for('student_dashboard') }}" class="nav-link active">
                    <i class="fas fa-home me-2"></i> Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="{{ url_for('logout') }}" class="nav-link">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </a>
            </li>
        </ul>
    </div>

    <!-- Main content -->
    <div class="content">

        <!-- Header -->
        <div class="header fade-in">
            <h2>Welcome, {{ student.name }}!</h2>
            <a href="{{ url_for('view_cart') }}" class="btn btn-outline-primary position-relative">
                <i class="fas fa-shopping-cart"></i>
                {% if cart_count > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ cart_count }}</span>
                {% endif %}
            </a>
        </div>

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show fade-in" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <!-- Dashboard Cards -->
        <div class="row justify-content-center g-4 fade-in">
    <div class="col-md-4 d-flex justify-content-center">
        <div class="dashboard-card w-100">
            <div class="icon-box icon-room"><i class="fas fa-bed"></i></div>
            <h4>Your Room</h4>
            <p>{% if student.room %}Room {{ student.room.room_no }}{% else %}Not Assigned{% endif %}</p>
        </div>
    </div>
    <div class="col-md-4 d-flex justify-content-center">
        <div class="dashboard-card w-100">
            <div class="icon-box icon-roll"><i class="fas fa-id-badge"></i></div>
            <h4>Your Roll No</h4>
            <p>{{ student.roll }}</p>
        </div>
    </div>
</div>

        <!-- Products Section -->
        <h3 class="mt-5 mb-3 fade-in">Available Products</h3>
        {% if products %}
        <div class="row g-4 fade-in">
            {% for product in products %}
            <div class="col-md-4">
                <div class="product-card h-100">
                    <h5>{{ product.name }}</h5>
                    <p>{{ product.description }}</p>
                    <p class="fw-bold">â‚¹{{ "%.2f"|format(product.price) }}</p>
                    <form action="{{ url_for('add_to_cart', product_id=product.id) }}" method="post">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-cart-plus me-1"></i>Add
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted">No products available.</p>
        {% endif %}

        <!-- Gate Pass Section -->
        <div class="d-flex justify-content-between align-items-center mt-5 mb-3 flex-wrap">
            <h3>ðŸšª Your Gate Passes</h3>
            <a href="{{ url_for('request_gate_pass') }}" class="btn btn-primary btn-sm">Request New Gate Pass</a>
        </div>

        {% if gate_passes %}
        <div class="row g-4 fade-in">
            {% for gp in gate_passes %}
            <div class="col-md-6">
                <div class="gate-pass-card">
                    <h5>{{ gp.reason }}</h5>
                    <p><strong>Leave:</strong> {{ gp.leave_date.strftime('%Y-%m-%d') }} | <strong>Return:</strong> {{ gp.return_date.strftime('%Y-%m-%d') }}</p>
                    <span class="badge-status
                        {% if gp.status == 'Pending' %}badge-pending{% elif gp.status == 'Approved' %}badge-approved{% else %}badge-rejected{% endif %}">
                        {{ gp.status }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-center text-muted mt-3">You have no gate pass requests.</p>
        {% endif %}

        <!-- Fees Summary -->
        <div class="card p-4 mt-5 fade-in" style="border-radius: 16px; backdrop-filter: blur(12px); background: rgba(255,255,255,0.85);">
            <h4>Fees Summary</h4>
            <table class="table table-bordered table-sm fees-table mb-3">
                <thead class="table-light">
                    <tr><th>Month</th><th>Due</th><th>Paid</th><th>Balance</th><th>Status</th></tr>
                </thead>
                <tbody>
                    {% for fee in months %}
                    <tr>
                        <td>{{ fee.month }} {{ fee.year }}</td>
                        <td>â‚¹{{ "%.2f"|format(fee.amount_due) }}</td>
                        <td>â‚¹{{ "%.2f"|format(fee.amount_paid) }}</td>
                        <td>â‚¹{{ "%.2f"|format(fee.amount_due - fee.amount_paid) }}</td>
                        <td>{{ fee.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="text-center">
                <a href="{{ url_for('my_fees_status') }}" class="btn btn-success btn-sm">Pay Fees ðŸ’³</a>
            </div>
        </div>

        <!-- Complaint Form -->
        <div class="card p-4 mt-5 fade-in" style="border-radius: 16px; backdrop-filter: blur(12px); background: rgba(255,255,255,0.85);">
            <h4>Submit Complaint</h4>
            <form action="{{ url_for('submit_complaint') }}" method="POST">
                <input type="text" name="title" class="form-control mb-2" placeholder="Title">
                <textarea name="complaint" rows="3" class="form-control mb-2" placeholder="Describe issue" required></textarea>
                <button type="submit" class="btn btn-primary w-100">Submit</button>
            </form>
        </div>

        <!-- Complaints Table -->
        <h4 class="mt-5 fade-in">My Complaints</h4>
        <table class="table table-sm table-bordered fade-in">
            <thead class="table-light">
                <tr><th>Title</th><th>Description</th><th>Status</th><th>Submitted On</th></tr>
            </thead>
            <tbody>
                {% for complaint in complaints %}
                <tr>
                    <td>{{ complaint.title }}</td>
                    <td>{{ complaint.description }}</td>
                    <td>{{ complaint.status }}</td>
                    <td>{{ complaint.date_submitted.strftime('%Y-%m-%d') if complaint.date_submitted else 'N/A' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="text-center text-muted">No complaints submitted yet.</td></tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
