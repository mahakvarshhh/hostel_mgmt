<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assign Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

<div class="w-full max-w-3xl p-8 space-y-6 bg-white rounded-xl shadow-lg border border-gray-200 fade-in">

    <h2 class="text-3xl font-bold text-center text-gray-800">Assign Room to {{ student.name }}</h2>
    <p class="text-center text-gray-500">Roll Number: {{ student.roll }}</p>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="space-y-2">
                {% for category, message in messages %}
                    <div class="relative px-4 py-2 rounded-lg text-sm font-medium
                        {% if category == 'success' %} bg-green-100 text-green-700
                        {% elif category == 'danger' %} bg-red-100 text-red-700
                        {% elif category == 'info' %} bg-blue-100 text-blue-700
                        {% endif %} shadow-sm">
                        {{ message }}
                        <button type="button" class="absolute top-1 right-2 text-gray-500 hover:text-gray-700"
                                onclick="this.parentElement.style.display='none';">
                            âœ•
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Rooms Table -->
    <div class="overflow-x-auto rounded-lg shadow-md">
        <table class="min-w-full table-auto border border-gray-200">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-2 border-b text-left">Room No</th>
                    <th class="px-4 py-2 border-b text-center">Capacity</th>
                    <th class="px-4 py-2 border-b text-center">Occupied</th>
                    <th class="px-4 py-2 border-b text-center">Available</th>
                </tr>
            </thead>
            <tbody>
                {% for room in rooms %}
                <tr class="text-center {% if room.occupied >= room.capacity %}bg-red-50{% else %}hover:bg-gray-50{% endif %} transition duration-200">
                    <td class="px-4 py-2 border-b text-left">{{ room.room_no }}</td>
                    <td class="px-4 py-2 border-b">{{ room.capacity }}</td>
                    <td class="px-4 py-2 border-b">{{ room.occupied }}</td>
                    <td class="px-4 py-2 border-b">{{ room.capacity - room.occupied }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Assign Room Dropdown -->
    <form method="POST" class="space-y-4">
        <label for="room_no" class="block text-sm font-medium text-gray-700">Select Room</label>
        <select id="room_no" name="room_no" required
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200">
            <option value="" disabled selected>Select a room</option>
            {% for room in rooms %}
                <option value="{{ room.room_no }}" 
                    {% if student.room and student.room.room_no == room.room_no %}selected{% endif %}>
                    Room {{ room.room_no }} ({{ room.occupied }}/{{ room.capacity }} occupied)
                </option>
            {% endfor %}
        </select>

        <!-- Centered Button -->
        <div class="flex justify-center">
            <button type="submit"
                class="mt-4 px-6 py-2 rounded-lg font-semibold transition duration-300 ease-in-out
                       {% if room_assigned %}bg-green-600 text-white hover:bg-green-700{% else %}bg-blue-600 text-white hover:bg-blue-700{% endif %}">
                {% if room_assigned %}Change Room{% else %}Assign Room{% endif %}
            </button>
        </div>
    </form>

    <!-- Back to Dashboard -->
    <div class="text-center mt-4">
        <a href="{{ url_for('admin_dashboard') }}" 
           class="inline-block py-2 px-4 text-sm font-medium text-blue-600 hover:text-blue-800 transition duration-200">
            &larr; Back to Dashboard
        </a>
    </div>

</div>

</body>
</html>
